# Webrtc

> Democratize real-time communication

## Basics

- To use less network there's encoding and decoding of media ("a [[codec]]")
- Transportation: dealing with packet ordering, packet loss.
- Session management (signaling).

## Getting media

The example here uses the `getUserMedia` api to get a hold of a `stream` object. It then plugs this stream object into a html5 video element using the `createObjectURL` API, giving the URL as a src to the video object.
Apparently this has been deprecated for security reasons in favor of [assigning the stream to a property](<(https://stackoverflow.com/questions/27120757/failed-to-execute-createobjecturl-on-url)>) (the `srcObject`) of the video element itself:

```javascript
const video = document.querySelector("video");
video.srcObject = stream;
```

`navigator.getUserMedia` [is deprecated](https://developer.mozilla.org/en-US/docs/Web/API/Navigator/getUserMedia) in favor of the **promise-returning** `navigator.mediaDevices .getUserMedia`

## WebRTC API

### `RTCPeerConnection`

Mantain the session and state of a peer connection. Exposes these through event handlers.
`const connection = new RTCPeerConnection(configuration)`

### Signaling/Negotiation

A common signaling process will include:

1. Generate a list of peer candidates
2. Select a peer
3. Notify peer that we wish to connect. Peer can accept or decline
4. Get notified of peer's response
5. (If accepted) initiate RTCPeerConnection with peer
6. Exchange hardware and software info over signaling channel
7. Exchange location information over signaling channel
8. Connection either succeeds or fails between users

Many signaling and negotiation protocols can be used such as [[SIP]] and [[XMPP]]

### Session Description Protocol [[SDP]]

"A business card for the machine". Key-value pairs separated by line breaks: `<key>=<value>\n`. in WebRTC it would cover

- Description
- Timing configuration
- Media constraints
- Encryption tipe
- ICE configurations

#### Routing

To actually get the media all the way after peers have found each other and negotiated it has to navigate the internet and also each peer's network. This is accomplished using:

- Session traversal utilities for NAT (STUN)
  A STUN server tells clients what their own 'external' IP is. Clients call it to know what their IP is.
  Browser vendors provide default STUN servers.

- Traversal Using Relays around NAT (TURN)
  For some restrictive network configuration a TURN _relay_ server can be added between peers. Then streaming on each peer is more like streaming any video on the network.

- Interactive Connectivity Establishment
  > ICE is a process that uses STUN and TURN to provide a successful route for peer to peer connections.
  > It finds a range of addresses available to each user and tests them in a sorted order. It incrementally discovers information about each peer's network to make a connection.
  > ICE candidates are found using STUN and TURN.

### Interactive Connectivity Establishment

[//begin]: # "Autogenerated link references for markdown compatibility"
[codec]: codec "Codec"
[//end]: # "Autogenerated link references"
